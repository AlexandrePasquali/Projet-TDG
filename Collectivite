//
// Source code recreated from a .class file by IntelliJ IDEA
// (powered by FernFlower decompiler)
//

package model;

import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;

public class Collectivite {
    private final String nom;
    private final Set<String> fermetures = new LinkedHashSet();
    private final Map<String, List<String>> contraintesHoraires = new LinkedHashMap();
    private final List<String> remarques = new ArrayList();
    private String planFichier = null;

    public Collectivite(String nom) {
        this.nom = nom;
    }

    public String getNom() {
        return this.nom;
    }

    private String keyOf(long u, long v) {
        return u <= v ? u + "-" + v : v + "-" + u;
    }

    public void signalerFermeture(long u, long v, String motif) {
        String k = this.keyOf(u, v);
        this.fermetures.add(k);
        if (motif != null && !motif.isBlank()) {
            this.remarques.add("Fermeture " + k + " : " + motif);
        } else {
            this.remarques.add("Fermeture " + k);
        }

    }

    public void enleverFermeture(long u, long v) {
        String k = this.keyOf(u, v);
        this.fermetures.remove(k);
        this.remarques.add("Réouverture " + k);
    }

    public Set<String> getFermetures() {
        return Collections.unmodifiableSet(this.fermetures);
    }

    public void ajouterContrainteHoraire(long u, long v, String plage) {
        String k = this.keyOf(u, v);
        ((List)this.contraintesHoraires.computeIfAbsent(k, (x) -> new ArrayList())).add(plage);
        this.remarques.add("Contrainte horaire " + k + " -> " + plage);
    }

    public Map<String, List<String>> getContraintesHoraires() {
        return Collections.unmodifiableMap(this.contraintesHoraires);
    }

    public void addRemarque(String r) {
        if (r != null && !r.isBlank()) {
            this.remarques.add(r);
        }

    }

    public List<String> getRemarques() {
        return Collections.unmodifiableList(this.remarques);
    }

    public void setPlanFichier(String path) {
        this.planFichier = path;
        this.remarques.add("Plan associé : " + path);
    }

    public String getPlanFichier() {
        return this.planFichier;
    }

    public void exporterSignalements(String outFile) throws IOException {
        try (FileWriter fw = new FileWriter(outFile)) {
            fw.write("Collectivité: " + this.nom + "\n\n");
            String var10001 = this.planFichier == null ? "non fourni" : this.planFichier;
            fw.write("Plan fichier: " + var10001 + "\n\n");
            fw.write("Fermetures signalées:\n");
            if (this.fermetures.isEmpty()) {
                fw.write("  (aucune)\n");
            } else {
                for(String f : this.fermetures) {
                    fw.write("  " + f + "\n");
                }
            }

            fw.write("\n");
            fw.write("Contraintes horaires:\n");
            if (this.contraintesHoraires.isEmpty()) {
                fw.write("  (aucune)\n");
            } else {
                for(Map.Entry<String, List<String>> e : this.contraintesHoraires.entrySet()) {
                    var10001 = (String)e.getKey();
                    fw.write("  " + var10001 + " -> " + String.join(", ", (Iterable)e.getValue()) + "\n");
                }
            }

            fw.write("\n");
            fw.write("Remarques:\n");
            if (this.remarques.isEmpty()) {
                fw.write("  (aucune)\n");
            } else {
                for(String r : this.remarques) {
                    fw.write("  - " + r + "\n");
                }
            }
        }

    }
}
